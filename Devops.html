<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Azure DevOps â€” Portal</title>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --azure:#0a66c2;
      --card-glass:#ffffff;
      --border-glass:rgba(0,0,0,0.06);
      --text:#0a1f3a;
      --muted:#6b7280;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:Poppins, sans-serif;
      min-height:100vh;
      background:#f3f4f6;
      display:flex;
      justify-content:flex-start;
      align-items:flex-start;
      padding:32px 24px;
      color:var(--text);
    }
    .container{
      width:1100px;max-width:100%;
      display:grid;grid-template-columns:420px 1fr;
      gap:26px;padding:28px;
      background:var(--card-glass);
      border:1px solid var(--border-glass);
      border-radius:22px;
      box-shadow:0 22px 60px rgba(15,23,42,0.12);
    }

    .left{
      padding:20px;border-radius:18px;
      background:#f9fafb;border:1px solid #e5e7eb;
      display:flex;flex-direction:column;
    }
    .brand{display:flex;gap:14px;margin-bottom:18px;align-items:center}
    .logo{
      width:60px;height:60px;border-radius:18px;
      background:#eef3ff;display:flex;align-items:center;justify-content:center;
      border:1px solid #d1d5db;
    }
    .title{font-size:22px;font-weight:700;margin-bottom:4px}
    .subtitle{font-size:14px;color:var(--muted);margin-bottom:14px}

    .btn{
      width:100%;padding:14px;margin-bottom:18px;
      background:var(--azure);border:none;border-radius:999px;
      font-weight:600;font-size:15px;color:white;
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;transition:.25s;
    }
    .btn:hover{transform:translateY(-2px)}

    .btn.danger-btn {
      background:#dc2626 !important;
      color:white !important;
    }
    .btn.danger-btn:hover {
      background:#b91c1c !important;
    }

    .signin-info{
      margin-top:4px;background:#f3f4ff;
      border:1px solid #e0e7ff;padding:16px;border-radius:14px;
      font-size:14px;color:var(--muted);
    }

    .right{
      padding:18px;border-radius:18px;
      background:#f9fbff;border:1px solid #e5e7eb;
      display:none;flex-direction:column;gap:18px;
    }
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .avatar{width:60px;height:60px;border-radius:18px;overflow:hidden;background:#e5e7eb}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .name{font-weight:700;font-size:18px}
    .muted{font-size:14px;color:var(--muted)}

    .cards{display:grid;grid-template-columns:1fr 1.1fr;gap:16px;margin-top:8px}
    .card{background:#ffffff;border:1px solid #e5e9ef;padding:18px;border-radius:16px}

    .org-list{list-style:none;margin-top:8px;padding-left:0}
    .org-list li{
      display:flex;gap:12px;padding:10px 12px;border-radius:12px;
      background:#eef2ff;border:1px solid #d4ddff;margin-bottom:8px;
    }

    .org-icon{
      width:38px;height:38px;border-radius:12px;
      background:linear-gradient(180deg,#2563eb,#1d4ed8);
      display:flex;justify-content:center;align-items:center;color:white;
      font-weight:700;flex-shrink:0;
    }
    .org-main{flex:1;font-size:13px}
    .owner-pill{padding:2px 8px;border-radius:999px;font-size:11px;font-weight:600;}
    .owner-yes{background:#dcfce7;color:#166534;}
    .owner-no{background:#fee2e2;color:#b91c1c;}

    #orgStatusMsg{min-height:1.2em;font-size:13px}
  </style>
</head>
<body>

<div class="container">
  <div class="left">
    <div class="brand">
      <div class="logo">ðŸ”„</div>
      <div>
        <div class="title">Azure DevOps Portal</div>
        <div class="subtitle">Secure sign-in to access dashboard</div>
      </div>
    </div>

    <!-- Spinner removed here -->
    <button id="startBtn" class="btn">
      <span id="startText">Sign in with Microsoft</span>
    </button>

    <div class="signin-info">Use your Microsoft organizational email to sign in.</div>
  </div>

  <div class="right" id="dashboard">
    <div class="topbar">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="avatar"><img id="avatarImg" /></div>
        <div>
          <div class="name" id="displayName">--</div>
          <div class="muted" id="displayEmail">--</div>
        </div>
      </div>
      <button id="signOutTop" class="btn danger-btn">Logout</button>
    </div>

    <div class="cards">
      <div class="card">
        <h3>Profile</h3>
        <p><strong>Name:</strong> <span id="nameVal">-</span></p>
        <p><strong>Email:</strong> <span id="emailVal">-</span></p>
        <p><strong>ID:</strong> <span id="idVal">-</span></p>
      </div>

      <div class="card">
        <h3>Organizations</h3>
        <ul class="org-list" id="orgList"><li>No organizations loaded.</li></ul>

        <div style="display:flex; gap:10px; margin-top:10px;">
          <button id="deleteSelectedBtn" class="btn danger-btn">Delete selected</button>
          <button id="refreshOrgsBtn" class="btn" style="background:#475569;">Refresh</button>
        </div>

        <p id="orgStatusMsg" class="muted" style="margin-top:6px;"></p>
      </div>
    </div>
  </div>
</div>

<script src="https://alcdn.msauth.net/browser/2.32.0/js/msal-browser.min.js"></script>
<script>
/* ---------- CONFIG ---------- */
const CLIENT_ID = "d3fa20a5-4696-48a1-b622-4e2dab8b6ea0";
const REDIRECT_URI = "https://trajak.github.io/azure-devops-login/Devops.html";

const msalConfig = {
  auth:{ clientId:CLIENT_ID, authority:"https://login.microsoftonline.com/common", redirectUri:REDIRECT_URI },
  cache:{ cacheLocation:"localStorage" }
};
const msalInstance = new msal.PublicClientApplication(msalConfig);

const loginScopes=["499b84ac-1321-427f-aa17-267ca6975798/.default"];

/* ---------- HELPERS ---------- */
function getDeleteBaseUrl(name, uri){
  let base="";
  if(uri){
    uri=uri.trim();
    if(uri.includes(".visualstudio.com")){
      const m=uri.match(/https:\/\/([^.]+)\.visualstudio\.com/i);
      if(m) base=`https://dev.azure.com/${m[1]}`;
    } else if(uri.includes("vssps.dev.azure.com")){
      base=uri.replace("vssps.dev.azure.com","dev.az
